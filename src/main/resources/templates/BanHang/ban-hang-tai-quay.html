<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{view/layout}"
>
  <head>
    <title>Qu·∫£n l√Ω B√°n h√†ng</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div layout:fragment="content">
      <div class="container mt-4">
        <h2 class="mb-4">Qu·∫£n L√Ω B√°n H√†ng</h2>


        <!-- Form th√™m kh√°ch h√†ng m·ªõi -->
        <form
          th:action="@{/ban-hang/them-khach-hang}"
          method="post"
          class="row g-2 mb-5 border p-3 rounded"
        >
          <h5>Th√™m kh√°ch h√†ng m·ªõi</h5>
          <div class="col-md-3">
            <input
              type="text"
              name="ten"
              class="form-control"
              placeholder="T√™n kh√°ch h√†ng"
              required
            />
          </div>
          <div class="col-md-3">
            <input
              type="text"
              name="sdt"
              class="form-control"
              placeholder="S·ªë ƒëi·ªán tho·∫°i"
              required
            />
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-outline-success">
              üíæ L∆∞u kh√°ch h√†ng
            </button>
          </div>
        </form>
        <!-- Th√¥ng b√°o l·ªói n·∫øu c√≥ -->
        <div class="alert alert-danger" th:if="${thongBaoLoi != null}" th:text="${thongBaoLoi}"></div>
        
        <!-- Form ch·ªçn kh√°ch h√†ng c≈© -->
        <form
          th:action="@{/ban-hang/tao-hoa-don}"
          method="post"
          class="row g-2 mb-4"
        >
          <div class="col-md-4">
            <label>Ch·ªçn kh√°ch h√†ng c≈© (ho·∫∑c b·ªè tr·ªëng):</label>
            <select name="khachHangId" class="form-control">
              <option value="">-- Kh√°ch l·∫ª (kh√¥ng c·∫ßn th√¥ng tin) --</option>
              <option
                th:each="kh : ${khachHangList}"
                th:value="${kh.id}"
                th:text="${kh.ten + ' - ' + kh.sdt}"
              ></option>
            </select>
          </div>
          <div class="col-auto align-self-end">
            <button type="submit" class="btn btn-primary" th:disabled="${daCoNamHoaDonTam}">
              ‚ûï T·∫°o ƒê∆°n H√†ng
            </button>
            <small class="text-danger" th:if="${daCoNamHoaDonTam}">ƒê√£ ƒë·∫°t gi·ªõi h·∫°n 5 h√≥a ƒë∆°n t·∫°m</small>
          </div>
        </form>

        <!-- Danh s√°ch h√≥a ƒë∆°n -->
        <h5 class="bg-success text-white p-2 rounded">Danh S√°ch ƒê∆°n H√†ng</h5>
        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>STT</th>
              <th>M√£ ƒê∆°n H√†ng</th>
              <th>T√™n Kh√°ch H√†ng</th>
              <th>Ng√†y T·∫°o</th>
              <th>Tr·∫°ng Th√°i</th>
              <th>T·ªïng Ti·ªÅn</th>
              <th>H√†nh ƒê·ªông</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="hd, iterStat : ${hoaDonTamList}">
              <td th:text="${iterStat.count}"></td>
              <td th:text="${hd.id}"></td>
              <td
                th:text="${hd.khachHang != null ? hd.khachHang.ten : 'Kh√°ch l·∫ª'}"
              ></td>
              <td
                th:text="${#dates.format(hd.ngayTao, 'yyyy-MM-dd HH:mm:ss')}"
              ></td>
              <td>
                <span
                  th:classappend="${hd.trangThai == 1} ? 'text-success' : 'text-danger'"
                  th:text="${hd.trangThai == 1 ? 'Ho√†n t·∫•t' : 'Ch·ªù thanh to√°n'}"
                ></span>
              </td>
              <td
                th:text="${#numbers.formatDecimal(hd.tongTien, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"
              ></td>
              <td class="d-flex gap-1">
                <a
                  th:href="@{'/ban-hang/chon-hoa-don/' + ${hd.id}}"
                  class="btn btn-success btn-sm"
                  >Ch·ªçn</a
                >
                <form
                  th:action="@{/ban-hang/xoa-hoa-don/{id}(id=${hd.id})}"
                  method="get"
                  onsubmit="return confirm('X√°c nh·∫≠n xo√° h√≥a ƒë∆°n?')"
                >
                  <button class="btn btn-danger btn-sm">X√≥a</button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
