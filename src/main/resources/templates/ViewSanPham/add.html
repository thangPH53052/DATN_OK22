<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{view/layout}">
<head>
    <title>Th√™m s·∫£n ph·∫©m</title>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f2f4f8;
            color: #333;
        }

        h1 {
            text-align: center;
            font-weight: 600;
            margin: 20px 0;
        }

        form {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            width: 60%;
            margin: auto;
        }

        form > div {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #fdfdfd;
        }

        button[type="submit"] {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        button[type="submit"]:hover {
            background: #0056b3;
        }

        .back-link {
            width: 60%;
            margin: 0 auto 20px;
            text-align: left;
        }

        .back-link a {
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <h1>Th√™m s·∫£n ph·∫©m m·ªõi</h1>

    <div class="back-link">
        <a th:href="@{/san-pham/view}">‚Üê Quay l·∫°i danh s√°ch</a>
    </div>

    <!-- ‚úÖ FORM -->
    <form th:action="@{/san-pham/save}" method="post" enctype="multipart/form-data">
        <div><label>M√£ s·∫£n ph·∫©m:</label><input type="text" name="ma" required></div>
        <div><label>T√™n s·∫£n ph·∫©m:</label><input type="text" name="ten" required></div>

        <div><label>Danh m·ª•c:</label>
            <select name="idDanhMuc" required>
                <option value="">-- Ch·ªçn danh m·ª•c --</option>
                <option th:each="dm : ${danhMucs}" th:value="${dm.id}" th:text="${dm.ten}"></option>
            </select>
        </div>

        <div><label>Ch·∫•t li·ªáu:</label>
            <select name="idChatLieu" required>
                <option value="">-- Ch·ªçn ch·∫•t li·ªáu --</option>
                <option th:each="cl : ${chatLieus}" th:value="${cl.id}" th:text="${cl.ten}"></option>
            </select>
        </div>

        <div><label>Lo·∫°i kh√≥a:</label>
            <select name="idLoaiKhoa" required>
                <option value="">-- Ch·ªçn lo·∫°i kh√≥a --</option>
                <option th:each="lk : ${loaiKhoas}" th:value="${lk.id}" th:text="${lk.ten}"></option>
            </select>
        </div>

        <div><label>Ki·ªÉu d√¢y:</label>
            <select name="idKieuDay" required>
                <option value="">-- Ch·ªçn ki·ªÉu d√¢y --</option>
                <option th:each="kd : ${kieuDays}" th:value="${kd.id}" th:text="${kd.ten}"></option>
            </select>
        </div>

        <div><label>Th∆∞∆°ng hi·ªáu:</label>
            <select name="idThuongHieu" required>
                <option value="">-- Ch·ªçn th∆∞∆°ng hi·ªáu --</option>
                <option th:each="th : ${thuongHieus}" th:value="${th.id}" th:text="${th.ten}"></option>
            </select>
        </div>

        <div><label>M√¥ t·∫£:</label><textarea name="moTa" rows="3"></textarea></div>
        <div><label>Tr·ªçng l∆∞·ª£ng (Kg):</label><input type="number" name="canNang" step="0.01"></div>
        <div><label>Dung t√≠ch (L√≠t):</label><input type="number" name="dungTich" step="0.01"></div>
        <div><label>K√≠ch th∆∞·ªõc:</label><input type="text" name="kichThuoc"></div>
        <div><label>Tr·∫°ng th√°i:</label>
            <select name="trangThai" required>
                <option value="true">ƒêang b√°n</option>
                <option value="false">Ng·ª´ng b√°n</option>
            </select>
        </div>
        <div><label>H√¨nh ·∫£nh:</label><input type="file" name="hinhAnhs" multiple></div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="submit">üíæ L∆∞u s·∫£n ph·∫©m</button>
        </div>
    </form>

    <!-- ‚úÖ SweetAlert th√¥ng b√°o -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        let success = /*[[${successMessage}]]*/ null;
        let error = /*[[${errorMessage}]]*/ null;

        if (success) {
            Swal.fire({
                icon: 'success',
                title: 'Th√†nh c√¥ng',
                text: success,
                confirmButtonText: 'OK'
            });
        } else if (error) {
            Swal.fire({
                icon: 'error',
                title: 'L·ªói',
                text: error,
                confirmButtonText: 'OK'
            });
        }
        /*]]>*/
    </script>

    <!-- ‚úÖ JS ki·ªÉm tra b·∫Øt bu·ªôc -->
    <script>
        document.querySelector("form").addEventListener("submit", function (e) {
            const requiredFields = [
                "ma", "ten", "idDanhMuc", "idChatLieu",
                "idLoaiKhoa", "idKieuDay", "idThuongHieu", "trangThai"
            ];
            let valid = true;
            let firstInvalid = null;

            requiredFields.forEach(fieldName => {
                const input = document.querySelector(`[name="${fieldName}"]`);
                if (!input || input.value.trim() === "") {
                    input.style.border = "2px solid red";
                    valid = false;
                    if (!firstInvalid) firstInvalid = input;
                } else {
                    input.style.border = "1px solid #ccc";
                }
            });

            if (!valid) {
                e.preventDefault();
                if (firstInvalid) firstInvalid.focus();
                Swal.fire({
                    icon: "warning",
                    title: "Thi·∫øu th√¥ng tin",
                    text: "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc!",
                    confirmButtonText: "OK"
                });
            }
        });
    </script>
</div>
</body>
</html>
